{% extends "gpt/base.html" %}

{% block title %}Results{% endblock %}

{# Pass some data to the JavaScript #}
{% block meta %}
  <meta name='resultset_archived' content='{{ resultset.archived }}' />
  <meta name='resultset_id' content='{{ resultset.id }}' />
{% endblock %}

{% block content %}
  <h1>Results set</h1>
  <div>
    <input id='save_button' type='button' value='Save result set'/>
    <p>
      Query: <span id='query'>{{ resultset.query }}</span>
    </p>
  </div>
  {% if resultset.genes.all()|length == 0 %}
    No genes found!
  {% endif %}
  <p>
  {% for g in resultset.genes.all() %}
    <div>
      <h3><a href='http://www.ncbi.nlm.nih.gov/gene/{{ g.uid }}/'>Gene
          {{ g.name }} - {{ g.description }}</a></h3>
        <table class='item_summary'>
          <tr>
            <th>Gene ID</th>
            <td>{{ g.uid }}</td>
          </tr>
          <tr>
            <th>Chromosome</th>
            <td>{{ g.chromosome }}</td>
          </tr>
          <tr>
            <th>Genetic source</th>
            <td>{{ g.geneticsource }}</td>
          </tr>
          <tr>
            <th>Organism</th>
            <td>
              <a href='http://www.ncbi.nlm.nih.gov/taxonomy/{{ g.organism_taxid }}/'>
                {{ g.organism_name }} ({{ g.organism_commonname }})</a> - ID 
                {{ g.organism_taxid }}</td>
          </tr>
          <tr>
            <th>Summary</th>
            <td>{{ g.summary }}</td>
          </tr>
          <tr>
            <th>Genomic info</th>
            <td>
              {% for ginfo in g.genomicinfo_set.all() %}
                <a href='http://www.ncbi.nlm.nih.gov/nuccore/{{ ginfo.chraccver }}/'>
                  {{ ginfo.chraccver }}</a> - 
                  chromosome {{ ginfo.chrloc }}, 
                  {{ ginfo.chrstart }}:{{ ginfo.chrstop }}; 
                  exons: {{ ginfo.exoncount }}<br/>
              {% endfor %}
            </td>
          </tr>
          <tr>
            <th>Location history</th>
            <td>
              <table class='lochist'>
                <thead>
                  <tr>
                    <th>Annotation release</th>
                    <th>Assembly</th>
                    <th>Chromosome</th>
                    <th>Location</th>
                    <th><a href='' class='collapse-button'>+</a></th>
                  </tr>
                </thead>
                <tbody>
                  {% for lochist in g.locationhist_set.all() %}
                    <tr>
                      <td>{{ lochist.annotationrelease }}</td>
                      <td>{{ lochist.assemblyaccver }}</td>
                      <td>{{ lochist.chraccver }}</td>
                      <td>{{ lochist.chrstart }}:{{ lochist.chrstop }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </td>
          </tr>
        </table>

        
        
      {% for p in g.protein_set.all() %}
        <h4>Protein {{ p.uid }}</h4>
        <div>
          {{ p.caption }},
          {{ p.title }},
          {{ p.extra }},
          {{ p.gi }},
          {{ p.createdate }},
          {{ p.updatedate }},
          {{ p.taxid }},
          {{ p.slen }},
          {{ p.projectid }},
          {{ p.genome }},
          {{ p.organism }},
        </div>
      {% endfor %}
    </div>
  {% endfor %}
  </p>
{% endblock %}

